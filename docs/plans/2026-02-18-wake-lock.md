# Wake Lock Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Hold skjermen alltid på mens FocusTimer er åpen ved hjelp av Wake Lock API.

**Architecture:** Ny `useWakeLock` hook acquirer screen wake lock ved mount og releaser ved unmount. Lytter på `visibilitychange` for å re-acquire etter minimering. FocusTimer kaller hooken med én linje.

**Tech Stack:** React 18, TypeScript, Wake Lock API (nativt nettleser-API)

---

### Task 1: Lag `useWakeLock` hook

**Files:**
- Create: `src/hooks/useWakeLock.ts`

**Step 1: Opprett filen med denne implementasjonen**

```typescript
import { useEffect, useRef } from 'react'

export function useWakeLock() {
  const wakeLockRef = useRef<WakeLockSentinel | null>(null)

  useEffect(() => {
    if (!('wakeLock' in navigator)) return

    async function acquire() {
      try {
        wakeLockRef.current = await navigator.wakeLock.request('screen')
      } catch {
        // Feiler stille — f.eks. batteri lavt eller ikke støttet
      }
    }

    function handleVisibilityChange() {
      if (document.visibilityState === 'visible') {
        acquire()
      }
    }

    acquire()
    document.addEventListener('visibilitychange', handleVisibilityChange)

    return () => {
      document.removeEventListener('visibilitychange', handleVisibilityChange)
      wakeLockRef.current?.release()
      wakeLockRef.current = null
    }
  }, [])
}
```

**Step 2: Verifiser at TypeScript kompilerer**

```bash
cd /Users/kennethbareksten/Koding/neuro-planner && npx tsc --noEmit
```

Forventet: ingen feil

**Step 3: Commit**

```bash
git add src/hooks/useWakeLock.ts
git commit -m "feat: add useWakeLock hook to prevent screen sleep during focus timer"
```

---

### Task 2: Integrer hook i FocusTimer

**Files:**
- Modify: `src/components/planner/FocusTimer.tsx:1-8`

**Step 1: Legg til import øverst i FocusTimer.tsx**

Finn denne blokken øverst i filen:
```typescript
import { useState, useEffect, useMemo } from 'react'
import { X, Play, Pause, RotateCcw } from 'lucide-react'
import type { Task } from '../../types'
import { useTimer } from '../../hooks/useTimer'
import { formatSeconds } from '../../utils/timeHelpers'
import { hexToRgba } from '../../utils/colorHelpers'
import { notifyEncouragement, notifyCompletion } from '../../hooks/useNotifications'
```

Erstatt med:
```typescript
import { useState, useEffect, useMemo } from 'react'
import { X, Play, Pause, RotateCcw } from 'lucide-react'
import type { Task } from '../../types'
import { useTimer } from '../../hooks/useTimer'
import { useWakeLock } from '../../hooks/useWakeLock'
import { formatSeconds } from '../../utils/timeHelpers'
import { hexToRgba } from '../../utils/colorHelpers'
import { notifyEncouragement, notifyCompletion } from '../../hooks/useNotifications'
```

**Step 2: Kall hooken i FocusTimer-komponenten**

Finn denne linjen i `FocusTimer`-funksjonen:
```typescript
  const totalSeconds = task.durationMinutes * 60
```

Legg til `useWakeLock()` rett over:
```typescript
  useWakeLock()
  const totalSeconds = task.durationMinutes * 60
```

**Step 3: Verifiser at TypeScript kompilerer**

```bash
cd /Users/kennethbareksten/Koding/neuro-planner && npx tsc --noEmit
```

Forventet: ingen feil

**Step 4: Kjør dev-server og test manuelt**

```bash
npm run dev
```

Åpne appen, start en oppgave og åpne FocusTimer. Sjekk i Chrome DevTools → Application → Wake Locks at `screen` wake lock er aktiv. Lukk timeren og verifiser at den forsvinner.

**Step 5: Commit**

```bash
git add src/components/planner/FocusTimer.tsx
git commit -m "feat: keep screen awake while FocusTimer is open"
```

---

### Task 3: Deploy

**Step 1: Push til GitHub**

```bash
git push origin main
```

Vercel deployer automatisk. Verifiser på https://neurominder.vercel.app at appen bygger uten feil.
